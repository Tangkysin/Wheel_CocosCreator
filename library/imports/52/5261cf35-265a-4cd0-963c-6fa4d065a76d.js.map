{"version":3,"sources":["../../../../assets/Script/assets/Script/Wheel.js"],"names":["cc","Class","extends","Component","properties","spinBtn","default","type","Button","visible","displayName","wheelSp","Sprite","maxSpeed","Float","max","min","duration","tooltip","acc","targetID","Integer","springback","effectAudio","url","AudioClip","onLoad","log","wheelState","curSpeed","spinTime","gearNum","defaultAngle","gearAngle","node","angle","finalAngle","effectFlag","sys","isBrowser","loader","loadRes","err","res","on","Node","EventType","TOUCH_END","event","decAngle","bind","start","editBoxDidBegin","edit","editBoxDidChanged","text","editBoxDidEndEditing","parseInt","string","isNaN","alert","Math","round","random","update","dt","audioID","self","clip","audioEngine","playEffect","curRo","hadRo","act","rotateBy","seq","sequence","delayTime","callFunc","showRes","runAction","Config","require","gearInfo"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,iBAAS;AACLC,qBAAS,IADJ,EACe;AACpBC,kBAAMP,GAAGQ,MAFJ,EAEgB;AACrBC,qBAAS,IAHJ,EAGe;AACpBC,yBAAa,SAJR,CAImB;AAJnB,SADD;AAORC,iBAAS;AACLL,qBAAS,IADJ;AAELC,kBAAMP,GAAGY;AAFJ,SAPD;AAWRC,kBAAU;AACNP,qBAAS,CADH;AAENC,kBAAMP,GAAGc,KAFH;AAGNC,iBAAK,EAHC;AAINC,iBAAK;AAJC,SAXF;AAiBRC,kBAAU;AACNX,qBAAS,CADH;AAENC,kBAAMP,GAAGc,KAFH;AAGNC,iBAAK,CAHC;AAINC,iBAAK,CAJC;AAKNE,qBAAS;AALH,SAjBF;AAwBRC,aAAK;AACDb,qBAAS,GADR;AAEDC,kBAAMP,GAAGc,KAFR;AAGDC,iBAAK,GAHJ;AAIDC,iBAAK,IAJJ;AAKDE,qBAAS;AALR,SAxBG;AA+BRE,kBAAU;AACNd,qBAAS,CADH;AAENC,kBAAMP,GAAGqB,OAFH;AAGNN,iBAAK,EAHC;AAINC,iBAAK,CAJC;AAKNE,qBAAS;AALH,SA/BF;AAsCRI,oBAAY;AACRhB,qBAAS,KADD;AAERY,qBAAS;AAFD,SAtCJ;AA0CRK,qBAAa;AACTjB,qBAAS,IADA;AAETkB,iBAAKxB,GAAGyB;AAFC;AA1CL,KAHP;;AAmDL;AACAC,YAAQ,kBAAY;AAChB1B,WAAG2B,GAAH,CAAO,YAAP;AACA,aAAKC,UAAL,GAAkB,CAAlB;AACA,aAAKC,QAAL,GAAgB,CAAhB;AACA,aAAKC,QAAL,GAAgB,CAAhB,CAJgB,CAIqB;AACrC,aAAKC,OAAL,GAAe,EAAf;AACA,aAAKC,YAAL,GAAoB,MAAM,EAAN,GAAW,CAA/B,CANgB,CAMyB;AACzC,aAAKC,SAAL,GAAiB,MAAM,KAAKF,OAA5B,CAPgB,CAOuB;AACvC,aAAKpB,OAAL,CAAauB,IAAb,CAAkBC,KAAlB,GAA0B,KAAKH,YAA/B;AACA,aAAKI,UAAL,GAAkB,CAAlB,CATgB,CASqB;AACrC,aAAKC,UAAL,GAAkB,CAAlB,CAVgB,CAUqB;;AAErC,YAAI,CAACrC,GAAGsC,GAAH,CAAOC,SAAZ,EAAuB;AACnBvC,eAAGwC,MAAH,CAAUC,OAAV,CAAkB,sBAAlB,EAA0C,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAAE,oBAAID,GAAJ,EAAS;AAAE1C,uBAAG2B,GAAH,CAAO,YAAYe,GAAnB;AAA0B;AAAE,aAAvG;AACH;AACD,aAAKrC,OAAL,CAAa6B,IAAb,CAAkBU,EAAlB,CAAqB5C,GAAG6C,IAAH,CAAQC,SAAR,CAAkBC,SAAvC,EAAkD,UAAUC,KAAV,EAAiB;AAC/DhD,eAAG2B,GAAH,CAAO,YAAP;AACA,gBAAI,KAAKC,UAAL,KAAoB,CAAxB,EAA2B;AACvB;AACH;AACD,iBAAKqB,QAAL,GAAgB,IAAI,GAApB,CAL+D,CAKrC;AAC1B,iBAAKrB,UAAL,GAAkB,CAAlB;AACA,iBAAKC,QAAL,GAAgB,CAAhB;AACA,iBAAKC,QAAL,GAAgB,CAAhB;AACA;AACA;AACH,SAXiD,CAWhDoB,IAXgD,CAW3C,IAX2C,CAAlD;AAYH,KA/EI;;AAiFLC,WAAO,iBAAY;AACf;AACH,KAnFI;;AAqFL;AACA;AACA;AACA;AACA;AACA;;AAEAC,qBAAiB,yBAAUC,IAAV,EAAgB,CAChC,CA7FI;;AA+FLC,uBAAmB,2BAAUC,IAAV,EAAgB,CAClC,CAhGI;;AAkGLC,0BAAsB,8BAAUH,IAAV,EAAgB;AAClC,YAAIV,MAAMc,SAASJ,KAAKK,MAAd,CAAV;AACA,YAAIC,MAAMhB,GAAN,CAAJ,EAAgB;AACZ,gBAAI3C,GAAGsC,GAAH,CAAOC,SAAX,EAAsB;AAClBqB,sBAAM,wBAAN;AACH,aAFD,MAEO5D,GAAG2B,GAAH,CAAO,oBAAP;AACP,iBAAKP,QAAL,GAAgByC,KAAKC,KAAL,CAAWD,KAAKE,MAAL,MAAiB,KAAKhC,OAAL,GAAe,CAAhC,CAAX,CAAhB;AACA;AACH;AACD,aAAKX,QAAL,GAAgBuB,GAAhB;AACH,KA5GI;AA6GL;AACAqB,YAAQ,gBAAUC,EAAV,EAAc;AAClB,YAAI,KAAKrC,UAAL,KAAoB,CAAxB,EAA2B;AACvB;AACH;AACD;AACA;;AAEA;AACA,aAAKS,UAAL,IAAmB,KAAKR,QAAxB;AACA,YAAI,CAAC7B,GAAGsC,GAAH,CAAOC,SAAR,IAAqB,KAAKF,UAAL,IAAmB,KAAKJ,SAAjD,EAA4D;AACxD,gBAAI,KAAKiC,OAAT,EAAkB,CAEjB;AADG;;AAEJ;AACA,gBAAIC,OAAO,IAAX;AACAnE,eAAGwC,MAAH,CAAUC,OAAV,CAAkB,sBAAlB,EAA0CzC,GAAGyB,SAA7C,EAAwD,UAAUiB,GAAV,EAAe0B,IAAf,EAAqB;AAAED,qBAAKD,OAAL,GAAelE,GAAGqE,WAAH,CAAeC,UAAf,CAA0BF,IAA1B,CAAf,CAAgDD,KAAK9B,UAAL,GAAkB,CAAlB;AAAsB,aAArJ;AACA;AACA;AACH;;AAED,YAAI,KAAKT,UAAL,IAAmB,CAAvB,EAA0B;AACtB;AACA,iBAAKE,QAAL,IAAiBmC,EAAjB;AACA,iBAAKtD,OAAL,CAAauB,IAAb,CAAkBC,KAAlB,GAA0B,KAAKxB,OAAL,CAAauB,IAAb,CAAkBC,KAAlB,GAA0B,KAAKN,QAAzD;AACA,gBAAI,KAAKA,QAAL,IAAiB,KAAKhB,QAA1B,EAAoC;AAChC,qBAAKgB,QAAL,IAAiB,KAAKV,GAAtB;AACH,aAFD,MAGK;AACD,oBAAI,KAAKW,QAAL,GAAgB,KAAKb,QAAzB,EAAmC;AAC/B;AACH;AACD;AACA;AACA,qBAAKmB,UAAL,GAAkB,KAAKhB,QAAL,GAAgB,KAAKa,SAArB,GAAiC,KAAKD,YAAxD;AACA,qBAAKnB,QAAL,GAAgB,KAAKgB,QAArB;AACA,oBAAI,KAAKP,UAAT,EAAqB;AACjB,yBAAKc,UAAL,IAAmB,KAAKH,SAAxB;AACH;AACDjC,mBAAG2B,GAAH,CAAO,qBAAqB,KAAKS,UAAjC;AACA,qBAAKzB,OAAL,CAAauB,IAAb,CAAkBC,KAAlB,GAA0B,KAAKC,UAA/B;AACA,qBAAKR,UAAL,GAAkB,CAAlB;AACH;AACJ,SAtBD,MAuBK,IAAI,KAAKA,UAAL,IAAmB,CAAvB,EAA0B;AAC3B;AACA,gBAAI2C,QAAQ,KAAK5D,OAAL,CAAauB,IAAb,CAAkBC,KAA9B,CAF2B,CAEU;AACrC,gBAAIqC,QAAQD,QAAQ,KAAKnC,UAAzB;AACA,iBAAKP,QAAL,GAAgB,KAAKhB,QAAL,IAAiB,CAAC,KAAKoC,QAAL,GAAgBuB,KAAjB,IAA0B,KAAKvB,QAAhD,IAA4D,GAA5E;AACA,iBAAKtC,OAAL,CAAauB,IAAb,CAAkBC,KAAlB,GAA0BoC,QAAQ,KAAK1C,QAAvC;;AAEA,gBAAK,KAAKoB,QAAL,GAAgBuB,KAAjB,IAA2B,CAA/B,EAAkC;AAC9B;AACA,qBAAK5C,UAAL,GAAkB,CAAlB;AACA,qBAAKjB,OAAL,CAAauB,IAAb,CAAkBC,KAAlB,GAA0B,KAAKC,UAA/B;AACA,oBAAI,KAAKd,UAAT,EAAqB;AACjB;AACA;AACA,wBAAImD,MAAMzE,GAAG0E,QAAH,CAAY,GAAZ,EAAiB,CAAC,KAAKzC,SAAvB,CAAV;AACA,wBAAI0C,MAAM3E,GAAG4E,QAAH,CAAY5E,GAAG6E,SAAH,CAAa,GAAb,CAAZ,EAA+BJ,GAA/B,EAAoCzE,GAAG8E,QAAH,CAAY,KAAKC,OAAjB,EAA0B,IAA1B,CAApC,CAAV;AACA,yBAAKpE,OAAL,CAAauB,IAAb,CAAkB8C,SAAlB,CAA4BL,GAA5B;AACH,iBAND,MAOK;AACD,yBAAKI,OAAL;AACH;AACJ;AACJ;AACJ,KAhLI;AAiLLA,aAAS,mBAAY;AACjB,YAAIE,SAASC,QAAQ,QAAR,CAAb;AACA,YAAIlF,GAAGsC,GAAH,CAAOC,SAAX,EAAsB;AAClBqB,kBAAM,kBAAkBqB,OAAOE,QAAP,CAAgB,KAAK/D,QAArB,CAAxB;AACH,SAFD,MAGKpB,GAAG2B,GAAH,CAAOsD,OAAOE,QAAP,CAAgB,KAAK/D,QAArB,CAAP;AACR;AAvLI,CAAT","file":"Wheel.js","sourceRoot":"../../../../assets/Script","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        spinBtn: {\n            default: null,      // The default value will be used only when the component attachin                    // to a node for the first time\n            type: cc.Button,     // optional, default is typeof default\n            visible: true,      // optional, default is true\n            displayName: 'SpinBtn', // optional\n        },\n        wheelSp: {\n            default: null,\n            type: cc.Sprite\n        },\n        maxSpeed: {\n            default: 5,\n            type: cc.Float,\n            max: 15,\n            min: 2,\n        },\n        duration: {\n            default: 3,\n            type: cc.Float,\n            max: 5,\n            min: 1,\n            tooltip: \"减速前旋转时间\"\n        },\n        acc: {\n            default: 0.1,\n            type: cc.Float,\n            max: 0.2,\n            min: 0.01,\n            tooltip: \"加速度\"\n        },\n        targetID: {\n            default: 0,\n            type: cc.Integer,\n            max: 17,\n            min: 0,\n            tooltip: \"指定结束时的齿轮\"\n        },\n        springback: {\n            default: false,\n            tooltip: \"旋转结束是否回弹\"\n        },\n        effectAudio: {\n            default: null,\n            url: cc.AudioClip\n        }\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        cc.log(\"....onload\");\n        this.wheelState = 0;\n        this.curSpeed = 0;\n        this.spinTime = 0;                   //减速前旋转时间\n        this.gearNum = 18;\n        this.defaultAngle = 360 / 18 / 2;        //修正默认角度\n        this.gearAngle = 360 / this.gearNum;   //每个齿轮的角度\n        this.wheelSp.node.angle = this.defaultAngle;\n        this.finalAngle = 0;                 //最终结果指定的角度\n        this.effectFlag = 0;                 //用于音效播放\n\n        if (!cc.sys.isBrowser) {\n            cc.loader.loadRes('Sound/game_turntable', function (err, res) { if (err) { cc.log('...err:' + err); } });\n        }\n        this.spinBtn.node.on(cc.Node.EventType.TOUCH_END, function (event) {\n            cc.log(\"begin spin\");\n            if (this.wheelState !== 0) {\n                return;\n            }\n            this.decAngle = 2 * 360;  // 减速旋转两圈\n            this.wheelState = 1;\n            this.curSpeed = 0;\n            this.spinTime = 0;\n            // var act = cc.rotateTo(10, 360*10);\n            // this.wheelSp.node.runAction(act.easing(cc.easeSineInOut()));\n        }.bind(this));\n    },\n\n    start: function () {\n        // cc.log('....start');\n    },\n\n    // caculateFinalAngle: function (targetID) {\n    //     this.finalAngle = this.targetID * this.gearAngle + this.defaultAngle - 360;\n    //     if (this.springback) {\n    //         this.finalAngle += this.gearAngle;\n    //     }\n    // },\n\n    editBoxDidBegin: function (edit) {\n    },\n\n    editBoxDidChanged: function (text) {\n    },\n\n    editBoxDidEndEditing: function (edit) {\n        var res = parseInt(edit.string);\n        if (isNaN(res)) {\n            if (cc.sys.isBrowser) {\n                alert('please input a number!');\n            } else cc.log(\".....invalid input\");\n            this.targetID = Math.round(Math.random() * (this.gearNum - 1));\n            return;\n        }\n        this.targetID = res;\n    },\n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        if (this.wheelState === 0) {\n            return;\n        }\n        // cc.log('......update');\n        // cc.log('......state=%d',this.wheelState);\n\n        // 播放音效有可能卡\n        this.effectFlag += this.curSpeed;\n        if (!cc.sys.isBrowser && this.effectFlag >= this.gearAngle) {\n            if (this.audioID) {\n                // cc.audioEngine.pauseEffect(this.audioID);\n            }\n            // this.audioID = cc.audioEngine.playEffect(this.effectAudio,false);\n            var self = this;\n            cc.loader.loadRes(\"Sound/game_turntable\", cc.AudioClip, function (err, clip) { self.audioID = cc.audioEngine.playEffect(clip); self.effectFlag = 0; });\n            // this.audioID = cc.audioEngine.playEffect(cc.url.raw('resources/Sound/game_turntable.mp3'));\n            // this.effectFlag = 0;\n        }\n\n        if (this.wheelState == 1) {\n            // cc.log('....加速,speed:' + this.curSpeed);\n            this.spinTime += dt;\n            this.wheelSp.node.angle = this.wheelSp.node.angle + this.curSpeed;\n            if (this.curSpeed <= this.maxSpeed) {\n                this.curSpeed += this.acc;\n            }\n            else {\n                if (this.spinTime < this.duration) {\n                    return;\n                }\n                // cc.log('....开始减速');\n                //设置目标角度\n                this.finalAngle = this.targetID * this.gearAngle - this.defaultAngle;\n                this.maxSpeed = this.curSpeed;\n                if (this.springback) {\n                    this.finalAngle += this.gearAngle;\n                }\n                cc.log(\"this.finalAngle:\" + this.finalAngle)\n                this.wheelSp.node.angle = this.finalAngle;\n                this.wheelState = 2;\n            }\n        }\n        else if (this.wheelState == 2) {\n            // cc.log('......减速');\n            var curRo = this.wheelSp.node.angle; //应该等于finalAngle\n            var hadRo = curRo - this.finalAngle;\n            this.curSpeed = this.maxSpeed * ((this.decAngle - hadRo) / this.decAngle) + 0.2;\n            this.wheelSp.node.angle = curRo + this.curSpeed;\n\n            if ((this.decAngle - hadRo) <= 0) {\n                // cc.log('....停止');\n                this.wheelState = 0;\n                this.wheelSp.node.angle = this.finalAngle;\n                if (this.springback) {\n                    //倒转一个齿轮\n                    // var act = new cc.rotateBy(0.6, -this.gearAngle);\n                    var act = cc.rotateBy(0.6, -this.gearAngle);\n                    var seq = cc.sequence(cc.delayTime(0.2), act, cc.callFunc(this.showRes, this));\n                    this.wheelSp.node.runAction(seq);\n                }\n                else {\n                    this.showRes();\n                }\n            }\n        }\n    },\n    showRes: function () {\n        var Config = require(\"Config\");\n        if (cc.sys.isBrowser) {\n            alert('You have got ' + Config.gearInfo[this.targetID]);\n        }\n        else cc.log(Config.gearInfo[this.targetID]);\n    }\n});\n"]}